<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
	<link rel="stylesheet" href="style.css">
	<title>EJ1 VUE</title>
</head>

<body>
	<div id="app">
		<h1>Posts</h1>
		<div v-if="posts.length > 0" class="posts">
			<ul class="post" v-for="(post) in posts">
				<li>
					<p>Post Name: {{post.name}}</p>
					<p>Post content: {{post.content}}</p>
					<p>Author: {{post.author}}</p>
					<p id="insertedOn">{{post.insertedOn.split('T')[0]}}</p>
					<button v-on:click="deletePost(post)">Delete Post</button>
					<button v-on:click="editPostBtn(post)">Edit Post</button>
					<button v-on:click="">Schedule Publish</button>
				</li>
			</ul>
		</div>
		<p v-else>There are no posts yet</p>

		<div class="createEdit">
			<h2>{{ editing ? 'Edit post' : 'Create post'}}</h2>

			<form>
				<input type="text" placeholder="Post Name" v-model="form.postName" required>
				<input type="text" placeholder="Post content" v-model="form.postContent" required>
				<input type="text" placeholder="Post author" v-model="form.postAuthor" required>
			</form>
			<button v-if="!editing" @click="addPost">Add post</button>
			<button v-else @click="editPost">Edit post</button>
			<!-- {{ editing ? <button @click="addPost">Add post</button> : <button @click="addPost">Edit post</button>}} -->
		</div>
	</div>


	<script>
		const { createApp } = Vue;

		let app = createApp({
			data() {
				return {
					actualPostId: null,
					editing: false,
					posts: [

					],
					form: {
						id: '',
						postName: '',
						postContent: '',
						postAuthor: '',
						insertedOn: ''
					}
				}
			},
			methods: {
				addPost() {
					if (validateForm()) {
						this.posts.push({
							id: this.posts.length + 1,
							name: this.form.postName,
							content: this.form.postContent,
							author: this.form.postAuthor,
							insertedOn: new Date().toISOString()
						});
						this.emptyForm();
					}
				},
				editPost() {
					//TODO no coge bien el post con el index

					const postIndex = this.posts.findIndex(post => post.id === this.actualPostId);
					console.log(postIndex);
					if (postIndex !== -1) {
						if (validateForm()) {
							this.posts[postIndex].name = this.form.postName;
							this.posts[postIndex].content = this.form.postContent;
							this.posts[postIndex].author = this.form.postAuthor;
							this.emptyForm();
							this.editing = false;
						}
					} else {
						console.log('No post found');
					}

				},

				deletePost(post) {
					this.posts.splice(this.posts.indexOf(post), 1);
					editing = false;
					// this.posts = this.posts.filter(post => post.id !== postId);
				},
				editPostBtn(post) {
					this.editing = true;
					this.form.postName = post.name;
					this.form.postContent = post.content;
					this.form.postAuthor = post.author;
					this.actualPostId = post.id;
				},
				emptyForm() {
					this.form.postName = '';
					this.form.postContent = '';
					this.form.postAuthor = '';
				}
			}
		}).mount('#app');


		function validateForm() {
			const inputs = document.querySelectorAll('input[required]');
			let isValid = true;
			inputs.forEach(input => {
				if (input.value.trim() === '') {
					isValid = false;
				}
			});
			return isValid;
		}
	</script>
</body>

</html>